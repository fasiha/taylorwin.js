var tape = require("tape");
var taylorwin = require("../");

function maxRelativeError(dirt, gold) {
  return Math.max(...gold.map((g, i) => Math.abs(g - dirt[i]) / Math.abs(g)));
}

tape("Test various Taylor windows", function(test) {
  /* Obtained from Matlab */
  const gold = [
    {
      args : [ 20, 6, 35 ],
      res : [
        0.28568689205595776403612262583919800817966461181640625,
        0.36899375839879289262768224944011308252811431884765625,
        0.52061425326983457040341818355955183506011962890625,
        0.7148061301274297729690943015157245099544525146484375,
        0.92478475506018276153241686188266612589359283447265625,
        1.1312721847669637842415113482275046408176422119140625,
        1.32125295824053434756706337793730199337005615234375,
        1.4811335397423164295105380006134510040283203125,
        1.596027348720051808328435072326101362705230712890625,
        1.65542817961793620185062536620534956455230712890625,
        1.65542817961793620185062536620534956455230712890625,
        1.596027348720051808328435072326101362705230712890625,
        1.4811335397423164295105380006134510040283203125,
        1.32125295824053434756706337793730199337005615234375,
        1.1312721847669637842415113482275046408176422119140625,
        0.92478475506018276153241686188266612589359283447265625,
        0.7148061301274297729690943015157245099544525146484375,
        0.52061425326983457040341818355955183506011962890625,
        0.36899375839879289262768224944011308252811431884765625,
        0.28568689205595776403612262583919800817966461181640625,
      ]
    },
    {
      args : [ 10, 5, -25 ],
      res : [
        0.5808633750039795540232034909422509372234344482421875,
        0.72241129045218432924713169995811767876148223876953125,
        1.0205726892009738815403352418798021972179412841796875,
        1.2683173314484132987445264006964862346649169921875,
        1.407835313894449047467105629038996994495391845703125,
        1.407835313894449047467105629038996994495391845703125,
        1.2683173314484132987445264006964862346649169921875,
        1.0205726892009738815403352418798021972179412841796875,
        0.72241129045218432924713169995811767876148223876953125,
        0.5808633750039795540232034909422509372234344482421875,
      ]
    }
  ];
  for (trial of gold) {
    result = taylorwin(...trial.args);
    test.assert(maxRelativeError(result, trial.res) < 1e-14,
                "Matched stored window");
  }
  /* TODO: add frequency-domain tests for SLL and monotonicity of sidelobes? */
  test.end();
});
